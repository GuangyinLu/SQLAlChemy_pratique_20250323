{% extends 'base.html' %}

{% block title %}Gestion de Produit{% endblock %}

{% block css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/gestionVente.css') }}">
{% endblock %}

{% block content %}
<div class="main">
    <h2>Gestion de Vente!</h2>            
    
    <div class="row">
        <div class="col-md-4 border p-3 affiche search_menu">
  
            <div class="option_action">
                <div class="form-check">
                    <input type="radio" class="form-check-input" id="radio1" name="optradio" value="vue" checked>
                    <label class="form-check-label" for="radio1">Vue</label>
                </div>
                <div class="form-check">
                    <input type="radio" class="form-check-input" id="radio2" name="optradio" value="modifier">
                    <label class="form-check-label" for="radio2">Modifier</label>
                </div>
                <div class="form-check">
                    <input type="radio" class="form-check-input" id="radio3" name="optradio" value="ajouter">
                    <label class="form-check-label" for="radio3">Ajouter</label>
                </div>
                <div class="form-check">
                    <input type="radio" class="form-check-input" id="radio4" name="optradio" value="supprimer">
                    <label class="form-check-label" for="radio4">Supprimer</label>
                </div>
            </div>

            <div class="search_policy border search_menu_sub" id="search_policy">
                <div class="search_policy_label row">
                    <label class="col-md-3 col-md-offset-1">Name,Phone,Email,Policy_ID</label>
                    <input class="col-md-6 col-md-offset-1" type="text" id="policy_searchBox" onkeyup="search_policy()" placeholder="Recherche...">
                </div>
                                    
                <table class="table table-bordered table-striped table_policy" id="table_policy" data-type="policy">
                    <thead>
                        <tr id="search_policy_results_title"></tr>
                    </thead>
                    <tbody class="client_search-table" id="search_policy_results">
                        <!-- AJAX 动态填充 -->
                    </tbody>
                </table>
            </div>

            <div class="search_user border search_menu_sub d-none" id="search_user">
                <div class="search_user_label row">
                    <label class="col-md-3 col-md-offset-1">User</label>
                    <input class="col-md-6 col-md-offset-1" type="text" id="user_searchBox" onkeyup="search_user()" placeholder="Recherche...">
                </div>
                                    
                <table class="table table-bordered table-striped table_user" id="table_user" data-type="user">
                    <thead>
                        <tr id="search_user_results_title"></tr>
                    </thead>
                    <tbody class="client_search-table" id="search_user_results">
                        <!-- AJAX 动态填充 -->
                    </tbody>
                </table>
            </div>

            <div class="search_product border search_menu_sub d-none" id="search_product">
                <div class="search_product_label row">
                    <label class="col-md-3 col-md-offset-1">Product </label>
                    <input class="col-md-6 col-md-offset-1" type="text" id="product_searchBox" onkeyup="search_product()" placeholder="Recherche...">
                </div>
                                    
                <table class="table table-bordered table-striped table_product" id="table_product" data-type="product">
                    <thead>
                        <tr id="search_product_results_title"></tr>
                    </thead>
                    <tbody class="client_search-table" id="search_product_results">
                        <!-- AJAX 动态填充 -->
                    </tbody>
                </table>
            </div>

            <div class="search_discount border search_menu_sub d-none" id="search_discount">
                <div class="search_discount_label row">
                    <label class="col-md-3 col-md-offset-1">Discount</label>
                    <input class="col-md-6 col-md-offset-1" type="text" id="discount_searchBox" onkeyup="search_discount()" placeholder="Recherche...">
                </div>                                    
                <table class="table table-bordered table-striped table_discount" id="table_discount" data-type="discount">
                    <thead>
                        <tr id="search_discount_results_title"></tr>
                    </thead>
                    <tbody class="client_search-table" id="search_discount_results">
                        <!-- AJAX 动态填充 -->
                    </tbody>
                </table>
            </div>

            <div class="search_agent border search_menu_sub d-none" id="search_agent">
                <div class="search_agent_label row">
                    <label class="col-md-3 col-md-offset-1">Agent</label>
                    <input class="col-md-6 col-md-offset-1" type="text" id="agent_searchBox" onkeyup="search_agent()" placeholder="Recherche...">
                </div>                                    
                <table class="table table-bordered table-striped table_agent" id="table_agent" data-type="agent">
                    <thead>
                        <tr id="search_agent_results_title"></tr>
                    </thead>
                    <tbody class="client_search-table" id="search_agent_results">
                        <!-- AJAX 动态填充 -->
                    </tbody>
                </table>
            </div>

        </div>

        <div class="col-md-8 border p-3 affiche">

            <form id="product-form" class="form-horizontal user_info row">
                <div class="form-group-user border user_info">
                    <h4>User Information</h4>
                    <div class="form-group row">
                        <label for="Customer_ID" class="col-md-2 control-label">Customer_ID</label>
                        <div class="col-md-2">
                            <input type="number" class="form-control" name="Customer_ID" id="Customer_ID" disabled>
                        </div>
                        <label for="gender_select" class="col-md-1 offset-md-1 control-label">Gendre</label>
                        <div class="col-md-2">
                            <select class="form-control" id="gender_select" disabled>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="name_first" class="col-md-2 control-label">Name_first</label>
                        <div class="col-md-2">
                            <input type="text" class="form-control" name="Name_first" id="name_first" disabled>
                        </div>

                        <label for="name_middle" class="col-md-2 control-label">Name_middle</label>
                        <div class="col-md-2">
                            <input type="text" class="form-control" name="name_middle" id="name_middle" disabled>
                        </div>

                        <label for="name_last" class="col-md-2 control-label">Name_last</label>
                        <div class="col-md-2">
                            <input type="text" class="form-control" name="name_last" id="name_last" disabled>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="id_card_number" class="col-md-2 control-label">Number_Card_ID</label>
                        <div class="col-md-3">
                            <input type="text" class="form-control" name="id_card_number" id="id_card_number" disabled>
                        </div>
                        <label for="date_of_birth" class="col-md-2 control-label">Birth_Day</label>
                        <div class="col-md-4">
                            <input type="date" class="form-control" name="date_of_birth" id="date_of_birth" disabled>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="phone" class="col-md-1 control-label">Phone</label>
                        <div class="col-md-3">
                            <input type="tel" class="form-control" name="phone" id="phone" disabled>
                        </div>
                        <label for="email" class="col-md-1 offset-md-1 control-label">Email</label>
                        <div class="col-md-5">
                            <input type="email" class="form-control" name="email" id="email" disabled>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="address" class="col-md-1 control-label">Address</label>
                        <div class="col-md-8">
                            <input type="text" class="form-control" name="address" id="address" disabled>
                        </div>
                    </div>

                </div>

                <div class="form-group-product border product_info">
                    <h4>Product Information</h4>
                    <div class="form-group row">
                        <div class="form-group row">
                            <label for="product_id" class="col-md-2 control-label">Product_id</label>
                            <div class="col-md-2">
                                <input type="number" class="form-control" name="product_id" id="product_id" disabled>
                            </div>
                            <label for="product_name" class="col-md-2 offset-md-1 control-label">Product_name</label>
                            <div class="col-md-4">
                                <input type="text" class="form-control" name="product_name" id="product_name" disabled>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="category" class="col-md-1 control-label">Category</label>
                            <div class="col-md-3">
                                <input type="text" class="form-control" name="category" id="category" disabled>
                            </div>
                            <label for="coverage_amount" class="col-md-1 offset-md-1 control-label">Coverage_amount</label>
                            <div class="col-md-2">
                                <input type="number" class="form-control" name="coverage_amount" id="coverage_amount" disabled>
                            </div>
                            <label for="premium" class="col-md-1 control-label">Premium</label>
                            <div class="col-md-2">
                                <input type="number" class="form-control" name="premium" id="premium" disabled>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="description" class="col-md-2 control-label">Description</label>
                            <div class="col-md-6">
                                <textarea id="description" rows="5" cols="50" disabled></textarea>                                
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group-discount border discount_info">
                    <h4>Discount Information</h4>
                    <div class="form-group row">
                        <label for="discount_id" class="col-md-2 control-label">Discount_id</label>
                        <div class="col-md-2">
                            <input type="number" class="form-control" name="discount_id" id="discount_id" disabled>
                        </div>
                        <label for="discount_name" class="col-md-2 offset-md-2 control-label">Discount_name</label>
                        <div class="col-md-4">
                            <input type="text" class="form-control" name="discount_name" id="discount_name" disabled>
                        </div>                        
                    </div>

                    <div class="form-group row">
                        <label for="discount_type" class="col-md-2 control-label">Discount_type</label>
                        <div class="col-md-3">
                            <select class="form-control" id="discount_type" disabled>
                                <option value="Fixed">Fixed Amount</option>
                                <option value="Percentage">Percentage</option>
                            </select>
                        </div>
                        <label for="discount_value" class="col-md-2 offset-md-1 control-label">Discount_value</label>
                        <div class="col-md-2">
                            <input type="number" class="form-control" name="discount_value" id="discount_value" disabled>
                        </div>                        
                    </div>

                    <div class="form-group row">
                        <label for="start_date" class="col-md-2 control-label">Start_date</label>
                        <div class="col-md-4">
                            <input type="date" class="form-control" name="start_date" id="start_date" disabled>
                        </div>
                        <label for="end_date" class="col-md-2 control-label">End_date</label>
                        <div class="col-md-4">
                            <input type="date" class="form-control" name="end_date" id="end_date" disabled>
                        </div>
                    </div>
    
                </div>

                <div class="form-group-agent border agent_info">
                    <h4>Agent Information</h4>
                    <div class="form-group row">
                        <label for="agent_id" class="col-md-2 control-label">Agent_id</label>
                        <div class="col-md-2">
                            <input type="number" class="form-control" name="agent_id" id="agent_id" disabled>
                        </div>
                        <label for="agent_phone" class="col-md-1 offset-md-2 control-label">Phone</label>
                        <div class="col-md-3">
                            <input type="tel" class="form-control" name="agent_phone" id="agent_phone" disabled>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="agent_name_first" class="col-md-2 control-label">Name_first</label>
                        <div class="col-md-2">
                            <input type="text" class="form-control" name="agent_name_first" id="agent_name_first" disabled>
                        </div>
                        <label for="agent_name_middle" class="col-md-2 control-label">Name_middle</label>
                        <div class="col-md-2">
                            <input type="text" class="form-control" name="agent_name_middle" id="agent_name_middle" disabled>
                        </div>
                        <label for="agent_name_last" class="col-md-2 control-label">Name_last</label>
                        <div class="col-md-2">
                            <input type="text" class="form-control" name="agent_name_last" id="agent_name_last" disabled>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="agent_email" class="col-md-1 control-label">Email</label>
                        <div class="col-md-5">
                            <input type="email" class="form-control" name="agent_email" id="agent_email" disabled>
                        </div>
                        <label for="commission_rate" class="col-md-2 offset-md-2 control-label">Commission_rate</label>
                        <div class="col-md-2">
                            <input type="number" step="0.01" min="0" max="10" class="form-control" name="commission_rate" id="commission_rate" disabled>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="agent_address" class="col-md-2 control-label">Address</label>
                        <div class="col-md-8">
                            <input type="text" class="form-control" name="agent_address" id="agent_address" disabled>
                        </div>
                    </div>
                </div>

                <div class="form-group-policy border policy_info">
                    <h4>Policy Information</h4>   
                    <div class="form-group row">
                        <label for="policy_id" class="col-md-1 control-label">ID</label>
                        <div class="col-md-2">
                            <input type="number"  class="form-control" name="policy_id" id="policy_id" disabled>
                        </div>
                        <label for="policy_number" class="col-md-2 control-label">Policy Number</label>
                        <div class="col-md-3">
                            <input type="text"  class="form-control" name="policy_number" id="policy_number">
                        </div>
                        <label for="policy_status_type" class="col-md-1 control-label">status</label>
                        <div class="col-md-2">
                            <select class="form-control" id="policy_status_type" name="policy_status_type">
                                <option value="Active">Active</option>
                                <option value="Expired">Expired</option>
                                <option value="Pending" selected="selected">Pending</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                        </div>
                    </div> 
                    <div class="form-group row">
                        <label for="premium_amount" class="col-md-3 control-label">Premium amount</label>
                        <div class="col-md-2">
                            <input type="number" step="0.01" class="form-control" name="premium_amount" id="premium_amount">
                        </div>
                        <label for="final_premium" class="col-md-2 offset-md-1 control-label">Final Premium</label>
                        <div class="col-md-2">
                            <input type="number" step="0.01" class="form-control" name="final_premium" id="final_premium">
                        </div>
                    </div>           
                    <div class="form-group row">
                        <label for="policy_start_date" class="col-md-2 control-label">Start_date</label>
                        <div class="col-md-3">
                            <input type="date" class="form-control" name="policy_start_date" id="policy_start_date">
                        </div>
                        <label for="policy_end_date" class="col-md-2 offset-md-1 control-label">End_date</label>
                        <div class="col-md-3">
                            <input type="date" class="form-control" name="policy_end_date" id="policy_end_date">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-offset-2 col-md-10 btn-user">
                    <button type="submit" class="btn btn-default btn-danger border btn-user-conf">Confirmation</button>
                    </div>
                </div>
            
            </form>

        </div>
    </div>


</div>
{% endblock %}

{% block scripts %}

<script src="{{ url_for('static', filename='js/axios.min.js') }}"></script>

<script>

    function search_policy() {
        let query = document.getElementById('policy_searchBox').value;
        //fetch('/search?query=' + query)

        axios.get("policy_search", {params: {query: query}})
            .then(response => {
                let rows = "";                
                response.data.data.forEach(item => {                  
                    rows += `
                        <tr  onclick="handleRowClick(this)" data-id="${item.id}">
                            <td>${item.policy_id}</td>
                            <td>${item.name}</td>
                            <td>${item.phone}</td>
                            <td>${item.email}</td>
                        </tr>
                    `;
                });                
                document.getElementById("search_policy_results").innerHTML = rows;

                row_title = `
                        <tr>
                            <th>Policy ID</th>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Email</th>
                        </tr>
                    `;
                document.getElementById("search_policy_results_title").innerHTML = row_title;

            });
    }

    function search_user() {
        let query = document.getElementById('user_searchBox').value;
  
        axios.get("/gestionClient/user_search", {params: {query: query}})
            .then(response => {
                let rows = "";                
                response.data.data.forEach(item => {                  
                    rows += `
                        <tr  onclick="handleRowClick(this)" data-id="${item.id}">
                            <td>${item.id}</td>
                            <td>${item.name}</td>
                            <td>${item.phone}</td>
                            <td>${item.email}</td>
                        </tr>
                    `;
                });                
                document.getElementById("search_user_results").innerHTML = rows;

                row_title = `
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Email</th>
                        </tr>
                    `;
                document.getElementById("search_user_results_title").innerHTML = row_title;
            });
    }

    function search_product() {
        let query = document.getElementById('product_searchBox').value;
  
        axios.get("/gestionProduct/product_search", {params: {query: query}})
            .then(response => {
                let rows = "";                
                response.data.data.forEach(item => {                  
                    rows += `
                        <tr  onclick="handleRowClick(this)" data-id="${item.id}">
                            <td>${item.product_id}</td>
                            <td>${item.product_name}</td>
                            <td>${item.category}</td>
                            <td>${item.description}</td>
                        </tr>
                    `;
                });                
                document.getElementById("search_product_results").innerHTML = rows;

                row_title = `
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Desc</th>
                        </tr>
                    `;
                document.getElementById("search_product_results_title").innerHTML = row_title;
            });
    }

    function search_discount() {
        let query = document.getElementById('discount_searchBox').value;
  
        axios.get("/gestionDiscount/discount_search", {params: {query: query}})
            .then(response => {
                let rows = "";                
                response.data.data.forEach(item => {                  
                    rows += `
                        <tr  onclick="handleRowClick(this)" data-id="${item.id}">
                            <td>${item.discount_id}</td>
                            <td>${item.discount_name}</td>
                            <td>${item.discount_type}</td>
                            <td>${item.discount_value}</td>
                        </tr>
                    `;
                });                
                document.getElementById("search_discount_results").innerHTML = rows;

                row_title = `
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Value</th>
                        </tr>
                    `;
                document.getElementById("search_discount_results_title").innerHTML = row_title;
            });
    }

    function search_agent() {
        let query = document.getElementById('agent_searchBox').value;
  
        axios.get("/gestionAgent/agent_search", {params: {query: query}})
            .then(response => {
                let rows = "";                
                response.data.data.forEach(item => {                  
                    rows += `
                        <tr  onclick="handleRowClick(this)" data-id="${item.id}">
                            <td>${item.agent_id}</td>
                            <td>${item.agent_name}</td>
                            <td>${item.phone}</td>
                            <td>${item.email}</td>
                        </tr>
                    `;
                });                
                document.getElementById("search_agent_results").innerHTML = rows;

                row_title = `
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Email</th>
                        </tr>
                    `;
                document.getElementById("search_agent_results_title").innerHTML = row_title;
            });
    }

    // 处理行点击事件的函数
    function handleRowClick(row) {
        // 获取行数据
        const cells = row.cells;
        const rowData = {
            id: cells[0].textContent
        };
        let tableType = $(row).closest("table").attr("data-type");
       
        // 更新选中行样式
        clearSelectedRows();
        row.classList.add('selected');

        if (tableType === "user") {
            get_customer_per_info(rowData.id);
        } else if (tableType === "product") {
            get_product_per_info(rowData.id);
        } else if (tableType === "discount") {
            get_product_per_info(rowData.id);
        } else if (tableType === "agent") {
            get_agent_per_info(rowData.id);
        } else if (tableType === "policy") {
            axios.get("/gestionVente/policy_per_info", {params: {query: rowData.id}})
            .then(response => {                
                response.data.policy.forEach(item =>{ 
                    document.getElementById('product-form').reset();
                    document.getElementById("policy_id").value = item.policy_id;
                    document.getElementById("policy_number").value = String(item.policy_number);
                    document.getElementById("policy_status_type").value = String(item.status);
                    document.getElementById("premium_amount").value = String(item.premium_amount);
                    document.getElementById('final_premium').value = String(item.final_premium);
                    document.getElementById("policy_start_date").value = String(item.start_date);
                    document.getElementById("policy_end_date").value = String(item.end_date);

                    get_customer_per_info(item.customer_id);
                    get_product_per_info(item.product_id);
                    get_discount_per_info(item.discount_id);
                    get_agent_per_info(item.agent_id);
            })            
        }); 
        }

        // 调用其他函数并传递行数据

        
        // 可选：添加选中样式
        clearSelectedRows();
        row.classList.add('selected');
    }
            
    // 清除之前选中的行
    function clearSelectedRows() {
        const rows = document.querySelectorAll('.client_search-table tr');
        rows.forEach(row => row.classList.remove('selected'));
    }

    function get_customer_per_info(query) {
        axios.get("/gestionClient/customer_per_info", {params: {query: query}})
        .then(response => {                
            response.data.customer.forEach(item =>{ 
                document.getElementById("Customer_ID").value = item.Customer_ID;
                document.getElementById("name_first").value = String(item.Name_first);
                document.getElementById("name_middle").value = String(item.Name_middle);
                document.getElementById("name_last").value = String(item.Name_last);
                document.getElementById('gender_select').value = String(item.Gendre);
                document.getElementById("date_of_birth").value = String(item.Birth_Day);
                document.getElementById("phone").value = String(item.Phone);
                document.getElementById("email").value = String(item.Email);
                document.getElementById("address").value = String(item.Address);
                document.getElementById("id_card_number").value = item.Number_Card_ID;
            })            
        });    
    }

    function get_product_per_info(query) {
        axios.get("/gestionProduct/product_per_info", {params: {query: query}})
        .then(response => {                
            response.data.product.forEach(item =>{ 
                document.getElementById("product_id").value = item.product_id;
                document.getElementById("product_name").value = String(item.product_name);
                document.getElementById("category").value = String(item.category);
                document.getElementById("coverage_amount").value = item.coverage_amount;
                document.getElementById('premium').value = item.premium;
                document.getElementById("description").value = String(item.description);
            })             
        });    
    }

    function get_discount_per_info(query) {
        axios.get("/gestionDiscount/discount_per_info", {params: {query: query}})
        .then(response => {                
            response.data.discount.forEach(item =>{ 
                document.getElementById("discount_id").value = item.discount_id;
                document.getElementById("discount_name").value = String(item.discount_name);
                document.getElementById("discount_type").value = item.discount_type;
                document.getElementById("discount_value").value = item.discount_value;
                document.getElementById('start_date').value = String(item.start_date);
                document.getElementById("end_date").value = String(item.end_date);
            })             
        });    
    }
    
    function get_agent_per_info(query) {
        axios.get("/gestionAgent/agent_per_info", {params: {query: query}})
        .then(response => {                
            response.data.agent.forEach(item =>{ 
                document.getElementById("agent_id").value = item.agent_id;
                document.getElementById("agent_name_first").value = String(item.name_first);
                document.getElementById("agent_name_middle").value = item.name_middle;
                document.getElementById("agent_name_last").value = item.name_last;
                document.getElementById('agent_phone').value = String(item.phone);
                document.getElementById("agent_email").value = String(item.email);
                document.getElementById('agent_address').value = String(item.address);
                document.getElementById("commission_rate").value = String(item.commission_rate);
            })    
            
        });    
    }
    
    // 其他处理函数
    function processRowData(data) {
        console.log('处理行数据:', data);
        alert(`你点击了: ${data.name}, 年龄 ${data.age}, 来自 ${data.city}`);
        // 这里可以添加你的其他处理逻辑
    }

    //ajouter-modifier-supprimer
    document.getElementById("product-form").addEventListener("submit", function (event) {
            event.preventDefault();
            
            let action = document.querySelector("input[name='optradio']:checked").value;
            let policy_id = document.getElementById("policy_id").value;
            let customer_id = document.getElementById("Customer_ID").value;
            let product_id = document.getElementById("product_id").value;           
            let discount_id = document.getElementById("discount_id").value;
            let agent_id = document.getElementById("agent_id").value;
            let policy_number = document.getElementById("policy_number").value;
            let status = document.getElementById("policy_status_type").value;
            let premium_amount = document.getElementById("premium_amount").value;
            let final_premium = document.getElementById("final_premium").value;  
            let start_date = document.getElementById("policy_start_date").value;
            let end_date = document.getElementById("policy_end_date").value;

            let para_json = {
                query:policy_id,
                customer_id: customer_id,
                agent_id: agent_id,
                product_id: product_id,
                policy_number: policy_number,
                start_date: start_date,
                end_date: end_date,
                premium_amount: premium_amount,
                discount_id: discount_id,
                final_premium: final_premium,
                status: status
            };
            
            if (action == "modifier") {
                axios.post("modifier_policy", para_json)
                .then(response => {
                    alert(response.data.message || response.data.error);
                })
                .catch(error => console.error(error));
            } else if (action == "ajouter") {
                axios.post("ajouter_policy", para_json)
                .then(response => {
                    alert(response.data.message || response.data.error);
                })
                .catch(error => console.error(error));
            } else if (action == "supprimer") {
                axios.post("supprimer_policy", para_json)
                .then(response => {
                    alert(response.data.message || response.data.error);
                })
                .catch(error => console.error(error));
            }

            document.querySelector(`input[name="optradio"][value="vue"]`).checked = true;


        }
    );

    // option -menu search
    document.addEventListener('DOMContentLoaded', function() {
    const radioButtons = document.querySelectorAll('input[name="optradio"]');
    
    // Function to handle radio change
    function handleRadioChange() {
        // Hide all content sections first
        document.querySelectorAll('.search_menu_sub').forEach(section => {
            section.classList.add('d-none');
        });
        
        // Show the selected content
        const selectedValue = document.querySelector('input[name="optradio"]:checked').value;
        if (selectedValue == "vue") {
            document.getElementById(`search_policy`).classList.remove('d-none');
        } else if (selectedValue == "modifier") {
            document.getElementById(`search_policy`).classList.remove('d-none');
            document.getElementById(`search_agent`).classList.remove('d-none');
        } else if (selectedValue == "ajouter") {
            document.getElementById(`search_user`).classList.remove('d-none');
            document.getElementById(`search_product`).classList.remove('d-none');
            document.getElementById(`search_discount`).classList.remove('d-none');
            document.getElementById(`search_agent`).classList.remove('d-none');
        } else if (selectedValue == "supprimer") {
            document.getElementById(`search_policy`).classList.remove('d-none');
        }
        
    }
    
    // Add event listeners to all radio buttons
    radioButtons.forEach(radio => {
        radio.addEventListener('change', handleRadioChange);
    });
    
    // Initialize with the default checked radio
    handleRadioChange();
});

</script>

{% endblock %}